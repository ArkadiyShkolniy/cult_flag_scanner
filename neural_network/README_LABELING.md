# Интерактивный дашборд для разметки паттернов

## Описание

Дашборд `labeling_dashboard.py` позволяет интерактивно размечать паттерны "Флаг" для обучения нейронной сети.

## Возможности

✅ Загрузка свечных данных по тикеру и таймфрейму  
✅ Визуализация графика свечей  
✅ Интерактивная разметка 5 точек (T0-T4)  
✅ Автоматическое сохранение для обучения нейросети  
✅ Поддержка бычьих и медвежьих паттернов  
✅ Статистика размеченных данных  

## Запуск

```bash
# Перейдите в директорию проекта
cd complex_flag_scanner

# Запустите Streamlit
streamlit run neural_network/labeling_dashboard.py

# Дашборд откроется в браузере на http://localhost:8501
```

## Использование

### Шаг 1: Загрузка данных

1. В боковой панели введите **Тикер** (например, VKCO)
2. Выберите **Class Code** (TQBR для акций, SPBFUT для фьючерсов)
3. Выберите **Таймфрейм** (5m, 1h, 1d)
4. Настройте количество дней истории
5. Нажмите **"Загрузить данные"**

### Шаг 2: Разметка точек

После загрузки данных откроется график. Размечайте точки последовательно:

#### Для бычьего паттерна:
- **T0**: Низ начала флагштока (кликните по минимуму)
- **T1**: Высокая вершина флагштока (кликните по максимуму)
- **T2**: Низ первого отката (кликните по минимуму)
- **T3**: Высокий второй пик (кликните по максимуму)
- **T4**: Низ второго отката (кликните по минимуму)

#### Для медвежьего паттерна:
- **T0**: Высокий верх начала падения (кликните по максимуму)
- **T1**: Низ флагштока (кликните по минимуму)
- **T2**: Высокий первый откат (кликните по максимуму)
- **T3**: Низ второго дна (кликните по минимуму)
- **T4**: Высокий второй откат (кликните по максимуму)

### Способы отметки точек:

#### Способ 1: По индексу (рекомендуется)

1. В разделе "Отметить точки по индексу" введите индекс свечи
2. Нажмите кнопку "Отметить T0" (или T1, T2, и т.д.)
3. Точка автоматически определит правильную цену (high/low) в зависимости от типа паттерна

#### Способ 2: Через график (экспериментально)

1. Нажмите кнопку "T0" (или другую нужную точку)
2. Кликните на графике по нужной свече
3. Точка будет отмечена

### Шаг 3: Сохранение

1. После отметки всех 5 точек (T0-T4) нажмите **"Сохранить для обучения"**
2. Данные автоматически сохранятся в `neural_network/data/`
3. Запись добавится в `annotations.csv`

## Статус разметки

Внизу графика отображается статус каждой точки:
- ✅ - точка отмечена
- ⏳ - точка еще не отмечена

## Просмотр статистики

В разделе "Статистика размеченных данных" можно увидеть:
- Общее количество размеченных паттернов
- Распределение по меткам (бычий/медвежий/нет)
- Распределение по таймфреймам

## Советы

1. **Качество данных**: Отмечайте точки аккуратно - качество разметки влияет на обучение нейросети
2. **Баланс классов**: Старайтесь размечать примерно равное количество бычьих и медвежьих паттернов
3. **Ложные паттерны**: Также полезно помечать случаи, когда сканер нашел паттерн, но его на самом деле нет (label=0)
4. **Порядок точек**: Точки должны быть в хронологическом порядке T0 < T1 < T2 < T3 < T4

## Структура сохраняемых данных

После сохранения создаются:

```
neural_network/data/
├── candles/
│   └── vkco_1h_20240101_120000.csv  # CSV со свечами
└── annotations.csv                   # Запись с меткой
```

Файл `annotations.csv` содержит:
- Путь к CSV файлу
- Метку (0=нет, 1=бычий, 2=медвежий)
- Тикер и таймфрейм
- Заметки

## Интеграция с обучением

После накопления достаточного количества размеченных данных (рекомендуется 200+ образцов), можно обучить модель:

```python
from neural_network.model import create_model
from neural_network.trainer import ModelTrainer
from neural_network.data_loader import create_data_loader

# Загружаем размеченные данные
train_loader, val_loader = create_data_loader('neural_network/data')

# Создаем и обучаем модель
model = create_model(num_classes=3)
trainer = ModelTrainer(model)
trainer.train(train_loader, val_loader, epochs=50)
```

## Устранение неполадок

**График не отображается:**
- Убедитесь что данные загружены
- Проверьте что файл .env содержит TINKOFF_INVEST_TOKEN

**Точки не отмечаются:**
- Используйте способ отметки по индексу
- Проверьте что выбран правильный тип паттерна (бычий/медвежий)

**Ошибка сохранения:**
- Проверьте что все 5 точек отмечены
- Убедитесь что точки в хронологическом порядке

