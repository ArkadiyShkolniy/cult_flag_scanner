version: '3.8'

services:
  # 1. üé® –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞–∑–º–µ—Ç–∫–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
  labeling:
    build: .
    container_name: cult_labeling
    restart: unless-stopped
    entrypoint: ["/bin/bash", "/app/install_deps.sh"]
    command: streamlit run neural_network/labeling_dashboard.py --server.port=8501 --server.address=0.0.0.0
    volumes:
      - .:/app
    ports:
      - "8505:8501"
    env_file:
      - .env
    environment:
      - PYTHONUNBUFFERED=1
      - TZ=Europe/Moscow
    networks:
      - trading_network

  # 2. ü§ñ –¢–æ—Ä–≥–æ–≤—ã–π —Ä–æ–±–æ—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
  trading-bot-debug:
    build: .
    container_name: cult_trading_bot_debug
    restart: unless-stopped
    entrypoint: ["/bin/bash", "/app/install_deps.sh"]
    command: python3 service.py --mode debug --enable-trading --entry-mode ema_squeeze
    volumes:
      - .:/app
    env_file:
      - .env
    environment:
      - PYTHONUNBUFFERED=1
      - TZ=Europe/Moscow
      - DEBUG_MODE=True
      - DRY_RUN=True
      - SCAN_INTERVAL_SEC=60
      - USE_AI_FILTER=True
      - DATA_DIR=trading_bot
      - BOT_ENV=DEBUG
    networks:
      - trading_network
    deploy:
      resources:
        limits:
          memory: 1G

  # 3. üìä –î–∞—à–±–æ—Ä–¥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
  trading-dashboard-debug:
    build: .
    container_name: cult_dashboard_debug
    restart: unless-stopped
    entrypoint: ["/bin/bash", "/app/install_deps.sh"]
    command: streamlit run trading_bot/trading_dashboard.py --server.port=8501 --server.address=0.0.0.0
    volumes:
      - .:/app
    ports:
      - "8506:8501"
    env_file:
      - .env
    environment:
      - PYTHONUNBUFFERED=1
      - TZ=Europe/Moscow
      - DATA_DIR=trading_bot
      - BOT_ENV=DEBUG
    networks:
      - trading_network

  # 4. üí∞ –¢–æ—Ä–≥–æ–≤—ã–π —Ä–æ–±–æ—Ç –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —Ä—ã–Ω–∫–µ (PROD)
  trading-bot-prod:
    build: .
    container_name: cult_trading_bot_prod
    restart: unless-stopped
    entrypoint: ["/bin/bash", "/app/install_deps.sh"]
    command: python3 service.py --mode prod --enable-trading
    volumes:
      - .:/app
    env_file:
      - .env
    environment:
      - PYTHONUNBUFFERED=1
      - TZ=Europe/Moscow
      - BOT_ENV=PROD
      - DATA_DIR=trading_bot/data_prod
      - USE_AI_FILTER=False
    networks:
      - trading_network
    deploy:
      resources:
        limits:
          memory: 1G

  # 5. üìä –î–∞—à–±–æ—Ä–¥ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
  trading-dashboard-prod:
    build: .
    container_name: cult_dashboard_prod
    restart: unless-stopped
    entrypoint: ["/bin/bash", "/app/install_deps.sh"]
    command: streamlit run trading_bot/trading_dashboard.py --server.port=8501 --server.address=0.0.0.0
    volumes:
      - .:/app
    ports:
      - "8502:8501"
    env_file:
      - .env
    environment:
      - PYTHONUNBUFFERED=1
      - TZ=Europe/Moscow
      - BOT_ENV=PROD
      - DATA_DIR=trading_bot/data_prod
    networks:
      - trading_network

networks:
  trading_network:
    driver: bridge
