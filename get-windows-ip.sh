#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è IP –∞–¥—Ä–µ—Å–∞ Windows —Ö–æ—Å—Ç–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞—à–±–æ—Ä–¥–∞–º

echo "üåê –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞—à–±–æ—Ä–¥–∞–º —Å Mac"
echo "============================================"
echo ""

# IP –∞–¥—Ä–µ—Å Windows —Ö–æ—Å—Ç–∞ –≤ WSL2 —Å–µ—Ç–∏
WSL_HOST_IP=$(cat /etc/resolv.conf 2>/dev/null | grep nameserver | awk '{print $2}')

if [ -z "$WSL_HOST_IP" ]; then
    echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å IP –∞–¥—Ä–µ—Å Windows —Ö–æ—Å—Ç–∞"
    exit 1
fi

echo "üìç IP –∞–¥—Ä–µ—Å Windows —Ö–æ—Å—Ç–∞ (WSL2): $WSL_HOST_IP"
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤:"
PORTS=(8502 8505 8506)
PORT_NAMES=("üí∞ –ü—Ä–æ–¥–∞–∫—à–µ–Ω" "üé® –†–∞–∑–º–µ—Ç–∫–∞" "ü§ñ –û—Ç–ª–∞–¥–∫–∞")

for i in "${!PORTS[@]}"; do
    PORT=${PORTS[$i]}
    NAME=${PORT_NAMES[$i]}
    if netstat -tuln 2>/dev/null | grep -q ":$PORT " || ss -tuln 2>/dev/null | grep -q ":$PORT "; then
        echo "   ‚úÖ $NAME: –ø–æ—Ä—Ç $PORT –æ—Ç–∫—Ä—ã—Ç"
    else
        echo "   ‚ùå $NAME: –ø–æ—Ä—Ç $PORT –Ω–µ –æ—Ç–∫—Ä—ã—Ç"
    fi
done

echo ""
echo "üçé –î–ª—è –¥–æ—Å—Ç—É–ø–∞ —Å Mac –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ URL:"
echo ""
echo "   üé® –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ä–∞–∑–º–µ—Ç–∫–∏:"
echo "      http://$WSL_HOST_IP:8505"
echo ""
echo "   ü§ñ –î–∞—à–±–æ—Ä–¥ –æ—Ç–ª–∞–¥–∫–∏:"
echo "      http://$WSL_HOST_IP:8506"
echo ""
echo "   üí∞ –î–∞—à–±–æ—Ä–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:"
echo "      http://$WSL_HOST_IP:8502"
echo ""

# –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å IP –∞–¥—Ä–µ—Å Windows –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
echo "üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:"
echo "   –ï—Å–ª–∏ Mac –∏ Windows –≤ –æ–¥–Ω–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏,"
echo "   –≤–∞–º –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è IP –∞–¥—Ä–µ—Å Windows –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏."
echo ""
echo "   –ß—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –µ–≥–æ, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ Windows PowerShell:"
echo "   ipconfig | findstr IPv4"
echo ""
echo "   –ó–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç IP –≤–º–µ—Å—Ç–æ $WSL_HOST_IP"
echo ""
